<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyQuantAlpha - AI 量化助手</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked.js (Markdown渲染) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Highlight.js (代码高亮) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <!-- Chart.js (图表) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1f2937;
        }

        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        .code-editor {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            line-height: 1.5;
        }

        /* Markdown 样式 */
        .prose pre {
            background-color: #111827 !important;
            margin: 0;
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .prose code {
            color: #e5e7eb;
        }

        .prose h1,
        .prose h2,
        .prose h3 {
            color: #f3f4f6;
            font-weight: 600;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }

        .prose p {
            margin-bottom: 1em;
            color: #d1d5db;
        }

        .prose ul {
            list-style-type: disc;
            padding-left: 1.5em;
            margin-bottom: 1em;
            color: #d1d5db;
        }

        .prose strong {
            color: #f9fafb;
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700 h-14 flex items-center px-6 justify-between flex-shrink-0">
        <div class="flex items-center gap-2">
            <i data-lucide="brain-circuit" class="text-blue-500 w-6 h-6"></i>
            <h1 class="text-lg font-bold tracking-wide">PyQuant<span class="text-blue-500">Alpha</span></h1>
        </div>
        <div class="text-sm text-gray-400">
            <span id="status-indicator" class="inline-block w-2 h-2 rounded-full bg-green-500 mr-1"></span>
            System Ready
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex overflow-hidden">

        <!-- Left Sidebar: Chat -->
        <aside class="w-1/3 min-w-[350px] max-w-[500px] border-r border-gray-700 flex flex-col bg-gray-900/50">
            <!-- Chat History -->
            <div id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-4">
                <!-- Welcome Message -->
                <div class="flex gap-3">
                    <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center flex-shrink-0">
                        <i data-lucide="bot" class="w-5 h-5 text-white"></i>
                    </div>
                    <div
                        class="bg-gray-800 p-3 rounded-lg rounded-tl-none max-w-[85%] text-sm leading-relaxed shadow-sm">
                        你好！我是你的量化策略助手。
                        <br>你可以告诉我你的交易想法，比如：
                        <ul class="list-disc pl-4 mt-2 text-gray-400">
                            <li>"写一个双均线策略，金叉买入死叉卖出"</li>
                            <li>"基于 RSI 超买超卖的策略"</li>
                            <li>"布林带突破策略"</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 border-t border-gray-700 bg-gray-800">
                <form id="chat-form" class="relative">
                    <textarea id="user-input"
                        class="w-full bg-gray-900 border border-gray-600 rounded-lg pl-3 pr-10 py-2.5 text-sm focus:outline-none focus:border-blue-500 resize-none h-[50px] scrollbar-none"
                        placeholder="描述你的策略逻辑..." rows="1"></textarea>
                    <button type="submit"
                        class="absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-blue-500 hover:text-blue-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                        id="send-btn">
                        <i data-lucide="send-horizontal" class="w-5 h-5"></i>
                    </button>
                </form>
            </div>
        </aside>

        <!-- Right Workspace -->
        <div class="flex-1 flex flex-col bg-gray-950">

            <!-- Upper: Strategy View (Code/Explanation) -->
            <div class="h-3/5 border-b border-gray-700 flex flex-col">
                <!-- Toolbar -->
                <div class="h-10 border-b border-gray-800 bg-gray-900 flex items-center px-4 justify-between">
                    <!-- Tabs -->
                    <div class="flex gap-4 text-sm font-medium">
                        <button
                            class="text-blue-400 border-b-2 border-blue-400 pb-2 px-1 hover:text-blue-300 transition-colors tab-btn active"
                            data-tab="code">策略代码</button>
                        <button
                            class="text-gray-400 border-b-2 border-transparent pb-2 px-1 hover:text-gray-200 transition-colors tab-btn"
                            data-tab="explanation">AI 解读</button>
                    </div>

                    <!-- Code Actions -->
                    <div class="flex items-center gap-3">
                        <span id="strategy-status" class="text-xs text-gray-500 hidden">
                            <i data-lucide="check-circle" class="w-3 h-3 inline mr-1"></i>已校验
                        </span>
                        <button id="copy-code-btn"
                            class="hidden text-gray-400 hover:text-white p-1 rounded transition-colors" title="复制代码">
                            <i data-lucide="copy" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="flex-1 overflow-hidden relative group">
                    <!-- Code View -->
                    <div id="view-code" class="absolute inset-0 overflow-auto p-4 bg-[#0d1117] tab-content">
                        <pre><code class="language-python bg-transparent p-0 text-sm code-editor" id="code-display"># 暂时没有策略</code></pre>
                    </div>
                    <!-- Explanation View -->
                    <div id="view-explanation"
                        class="absolute inset-0 overflow-auto p-6 bg-gray-900 tab-content hidden">
                        <div id="explanation-display" class="prose prose-invert max-w-none text-sm">
                            <p class="text-gray-500 italic">暂无策略解读。</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lower: Backtest Panel -->
            <div class="flex-1 flex flex-col">
                <!-- Control Bar -->
                <div class="h-14 border-b border-gray-800 bg-gray-900 flex items-center px-4 gap-4 justify-between">
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2">
                            <i data-lucide="settings-2" class="w-4 h-4 text-gray-400"></i>
                            <span class="text-sm font-semibold text-gray-300">回测配置</span>
                        </div>

                        <!-- Inputs -->
                        <div class="flex gap-2 items-center">
                            <span id="bt-symbol"
                                class="bg-gray-800 border border-gray-700 rounded px-2 py-1 text-xs text-center uppercase text-blue-400 font-medium min-w-[60px]">BTCUSDT</span>
                            <select
                                class="bg-gray-800 border border-gray-700 rounded px-2 py-1 text-xs focus:border-blue-500 outline-none"
                                id="bt-interval">
                                <option value="1h">1H</option>
                                <option value="4h">4H</option>
                                <option value="1d">1D</option>
                            </select>
                            <input type="number" value="30"
                                class="bg-gray-800 border border-gray-700 rounded px-2 py-1 text-xs w-16 text-center focus:border-blue-500 outline-none"
                                id="bt-days">
                            <span class="text-xs text-gray-500 self-center">天</span>
                        </div>
                    </div>

                    <button id="run-backtest-btn"
                        class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-1.5 rounded text-sm font-medium flex items-center gap-2 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i data-lucide="play" class="w-4 h-4"></i>
                        运行回测
                    </button>
                </div>

                <!-- Dashboard Content -->
                <div class="flex-1 flex overflow-hidden">
                    <!-- Left: Metrics -->
                    <div class="w-64 border-r border-gray-800 bg-gray-900/30 p-4 space-y-4 overflow-y-auto">
                        <!-- Progress -->
                        <div class="mb-4">
                            <div class="flex justify-between text-xs text-gray-400 mb-1">
                                <span>进度</span>
                                <span id="progress-text">0%</span>
                            </div>
                            <div class="h-1.5 bg-gray-700 rounded-full overflow-hidden">
                                <div id="progress-bar" class="h-full bg-blue-500 w-0 transition-all duration-300"></div>
                            </div>
                        </div>

                        <!-- Metrics Grid -->
                        <div class="grid grid-cols-1 gap-3">
                            <div class="bg-gray-800 rounded p-3">
                                <div class="text-xs text-gray-500 mb-1">总收益率</div>
                                <div class="text-lg font-bold text-green-400" id="metric-return">--%</div>
                            </div>
                            <div class="bg-gray-800 rounded p-3">
                                <div class="text-xs text-gray-500 mb-1">夏普比率</div>
                                <div class="text-lg font-bold text-gray-200" id="metric-sharpe">--</div>
                            </div>
                            <div class="bg-gray-800 rounded p-3">
                                <div class="text-xs text-gray-500 mb-1">最大回撤</div>
                                <div class="text-lg font-bold text-red-400" id="metric-drawdown">--%</div>
                            </div>
                            <div class="bg-gray-800 rounded p-3">
                                <div class="text-xs text-gray-500 mb-1">胜率</div>
                                <div class="text-lg font-bold text-blue-400" id="metric-winrate">--%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Chart -->
                    <div class="flex-1 p-4 relative bg-[#0b0e14]">
                        <!-- Chart Title -->
                        <div id="chart-title" class="absolute top-2 left-4 text-sm text-gray-400 font-medium z-10">
                            <span id="chart-symbol">BTCUSDT</span> 净值曲线
                        </div>
                        <canvas id="equity-chart"></canvas>
                        <!-- Chart Overlay for Empty State -->
                        <div id="chart-overlay"
                            class="absolute inset-0 flex items-center justify-center bg-gray-900/10 pointer-events-none">
                            <div class="text-gray-600 text-sm flex flex-col items-center gap-2">
                                <i data-lucide="activity" class="w-8 h-8 opacity-50"></i>
                                <span>运行策略以查看净值曲线</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- JS Imports -->
    <script src="/static/js/api.js"></script>
    <script src="/static/js/ui.js"></script>
    <script src="/static/js/app.js"></script>
    <script>
        // Init Icons
        lucide.createIcons();
    </script>
</body>

</html>