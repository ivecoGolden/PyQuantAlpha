<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyQuantAlpha - AI é‡åŒ–ç­–ç•¥å¹³å°</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>

    <!-- Marked.js for Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }

        /* Hide scrollbar for specific elements */
        .scrollbar-none::-webkit-scrollbar {
            display: none;
        }

        /* Code editor styling */
        .code-editor {
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
        }

        /* Prose (Markdown) styling */
        .prose h1,
        .prose h2,
        .prose h3 {
            color: #e5e7eb;
        }

        .prose code {
            background: #1f2937;
            padding: 0.2em 0.4em;
            border-radius: 4px;
        }

        .prose ul,
        .prose ol {
            padding-left: 1.5em;
        }

        .tab-btn.active {
            color: #60a5fa;
            border-color: #3b82f6;
        }
    </style>
</head>

<body class="bg-gray-950 text-gray-100 h-screen flex flex-col overflow-hidden antialiased">

    <!-- Top Nav -->
    <nav class="h-12 border-b border-gray-800 bg-gray-900/50 flex items-center px-4 justify-between shrink-0">
        <div class="flex items-center gap-3">
            <div
                class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                <i data-lucide="activity" class="w-5 h-5 text-white"></i>
            </div>
            <span class="font-bold text-lg">PyQuantAlpha</span>
            <span class="text-xs text-gray-500 border border-gray-700 rounded px-1.5 py-0.5">v0.2.0</span>
        </div>
        <div class="flex items-center gap-4">
            <span class="text-xs text-gray-500">AI Quant Platform</span>
        </div>
    </nav>

    <main class="flex-1 flex overflow-hidden">

        <!-- Left Sidebar: Chat -->
        <aside class="w-1/3 min-w-[350px] max-w-[500px] border-r border-gray-700 flex flex-col bg-gray-900/50">
            <!-- Chat History -->
            <div id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-4">
                <!-- Welcome Message -->
                <div class="flex gap-3">
                    <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center flex-shrink-0">
                        <i data-lucide="bot" class="w-5 h-5 text-white"></i>
                    </div>
                    <div
                        class="bg-gray-800 p-3 rounded-lg rounded-tl-none max-w-[85%] text-sm leading-relaxed shadow-sm">
                        ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„é‡åŒ–ç­–ç•¥åŠ©æ‰‹ã€‚
                        <br>ä½ å¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„äº¤æ˜“æƒ³æ³•ï¼Œæ¯”å¦‚ï¼š
                        <ul class="list-disc pl-4 mt-2 text-gray-400">
                            <li>"å†™ä¸€ä¸ªåŒå‡çº¿ç­–ç•¥ï¼Œé‡‘å‰ä¹°å…¥æ­»å‰å–å‡º"</li>
                            <li>"åŸºäº RSI è¶…ä¹°è¶…å–çš„ç­–ç•¥"</li>
                            <li>"å¸ƒæ—å¸¦çªç ´ç­–ç•¥"</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 border-t border-gray-700 bg-gray-800">
                <form id="chat-form" class="relative">
                    <textarea id="user-input"
                        class="w-full bg-gray-900 border border-gray-600 rounded-lg pl-3 pr-10 py-2.5 text-sm focus:outline-none focus:border-blue-500 resize-none h-[50px] scrollbar-none"
                        placeholder="æè¿°ä½ çš„ç­–ç•¥é€»è¾‘..." rows="1"></textarea>
                    <button type="submit"
                        class="absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-blue-500 hover:text-blue-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                        id="send-btn">
                        <i data-lucide="send-horizontal" class="w-5 h-5"></i>
                    </button>
                </form>
            </div>
        </aside>

        <!-- Right Workspace: Tabbed View -->
        <div class="flex-1 flex flex-col bg-gray-950">

            <!-- Tab Bar -->
            <div class="h-12 border-b border-gray-800 bg-gray-900 flex items-center px-4 justify-between shrink-0">
                <!-- Tabs -->
                <div class="flex gap-1 text-sm font-medium">
                    <button
                        class="px-4 py-2 rounded-t text-blue-400 bg-gray-950 border-t border-l border-r border-gray-700 -mb-px tab-btn active"
                        data-tab="code">ğŸ“ ç­–ç•¥ä»£ç </button>
                    <button class="px-4 py-2 rounded-t text-gray-400 hover:text-gray-200 transition-colors tab-btn"
                        data-tab="explanation">ğŸ’¡ AI è§£è¯»</button>
                    <button class="px-4 py-2 rounded-t text-gray-400 hover:text-gray-200 transition-colors tab-btn"
                        data-tab="backtest">ğŸ“Š å›æµ‹ç»“æœ</button>
                </div>

                <!-- Actions -->
                <div class="flex items-center gap-3">
                    <span id="strategy-status" class="text-xs text-gray-500 hidden">
                        <i data-lucide="check-circle" class="w-3 h-3 inline mr-1"></i>å·²æ ¡éªŒ
                    </span>
                    <button id="copy-code-btn"
                        class="hidden text-gray-400 hover:text-white p-1 rounded transition-colors" title="å¤åˆ¶ä»£ç ">
                        <i data-lucide="copy" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <!-- Tab Content Area -->
            <div class="flex-1 overflow-hidden relative">

                <!-- Code View -->
                <div id="view-code" class="absolute inset-0 overflow-auto p-4 bg-[#0d1117] tab-content">
                    <pre><code class="language-python bg-transparent p-0 text-sm code-editor" id="code-display"># æš‚æ—¶æ²¡æœ‰ç­–ç•¥</code></pre>
                </div>

                <!-- Explanation View -->
                <div id="view-explanation" class="absolute inset-0 overflow-auto p-6 bg-gray-900 tab-content hidden">
                    <div id="explanation-display" class="prose prose-invert max-w-none text-sm">
                        <p class="text-gray-500 italic">æš‚æ— ç­–ç•¥è§£è¯»ã€‚</p>
                    </div>
                </div>

                <!-- Backtest View -->
                <div id="view-backtest" class="absolute inset-0 flex flex-col bg-gray-950 tab-content hidden">

                    <!-- Backtest Control Bar -->
                    <div
                        class="h-12 border-b border-gray-800 bg-gray-900 flex items-center px-4 gap-4 justify-between shrink-0">
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-2">
                                <i data-lucide="settings-2" class="w-4 h-4 text-gray-400"></i>
                                <span class="text-sm font-semibold text-gray-300">é…ç½®</span>
                            </div>
                            <div class="flex gap-2 items-center">
                                <div
                                    class="flex items-center gap-1.5 px-2 py-1 bg-gray-900/50 border border-gray-800 rounded">
                                    <span class="text-xs text-gray-500">Target:</span>
                                    <span id="bt-symbol" class="text-xs font-mono text-blue-400">--</span>
                                </div>
                                <select
                                    class="bg-gray-800 border border-gray-700 rounded px-2 py-1 text-xs focus:border-blue-500 outline-none"
                                    id="bt-interval">
                                    <option value="1h">1H</option>
                                    <option value="4h">4H</option>
                                    <option value="1d">1D</option>
                                </select>
                                <input type="number" value="30"
                                    class="bg-gray-800 border border-gray-700 rounded px-2 py-1 text-xs w-16 text-center focus:border-blue-500 outline-none"
                                    id="bt-days">
                                <span class="text-xs text-gray-500">å¤©</span>
                            </div>
                        </div>
                        <button id="run-backtest-btn"
                            class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-1.5 rounded text-sm font-medium flex items-center gap-2 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i data-lucide="play" class="w-4 h-4"></i>
                            è¿è¡Œå›æµ‹
                        </button>
                    </div>

                    <!-- Backtest Dashboard -->
                    <div class="flex-1 flex overflow-hidden">
                        <!-- Left: Metrics -->
                        <div
                            class="w-56 border-r border-gray-800 bg-gray-900/30 p-3 space-y-3 overflow-y-auto shrink-0">
                            <!-- Progress -->
                            <div>
                                <div class="flex justify-between text-xs text-gray-400 mb-1">
                                    <span>è¿›åº¦</span>
                                    <span id="progress-text">0%</span>
                                </div>
                                <div class="h-1.5 bg-gray-700 rounded-full overflow-hidden">
                                    <div id="progress-bar" class="h-full bg-blue-500 w-0 transition-all duration-300">
                                    </div>
                                </div>
                            </div>
                            <!-- Metrics Grid -->
                            <div class="grid grid-cols-1 gap-2">
                                <div class="bg-gray-800 rounded p-2">
                                    <div class="text-xs text-gray-500 mb-0.5">æ€»æ”¶ç›Šç‡</div>
                                    <div class="text-lg font-bold text-green-400" id="metric-return">--%</div>
                                </div>
                                <div class="bg-gray-800 rounded p-2">
                                    <div class="text-xs text-gray-500 mb-0.5">å¤æ™®æ¯”ç‡</div>
                                    <div class="text-lg font-bold text-gray-200" id="metric-sharpe">--</div>
                                </div>
                                <div class="bg-gray-800 rounded p-2">
                                    <div class="text-xs text-gray-500 mb-0.5">æœ€å¤§å›æ’¤</div>
                                    <div class="text-lg font-bold text-red-400" id="metric-drawdown">--%</div>
                                </div>
                                <div class="bg-gray-800 rounded p-2">
                                    <div class="text-xs text-gray-500 mb-0.5">èƒœç‡</div>
                                    <div class="text-lg font-bold text-blue-400" id="metric-winrate">--%</div>
                                </div>
                            </div>
                        </div>

                        <!-- Right: Chart + Logs -->
                        <div class="flex-1 flex flex-col bg-[#0b0e14]">
                            <!-- Chart Area -->
                            <div class="flex-1 p-3 relative min-h-[180px]">
                                <div id="chart-title"
                                    class="absolute top-2 left-3 text-sm text-gray-400 font-medium z-10">
                                    <span id="chart-symbol">BTCUSDT</span> å‡€å€¼æ›²çº¿
                                </div>
                                <canvas id="equity-chart"></canvas>
                                <div id="chart-overlay"
                                    class="absolute inset-0 flex items-center justify-center bg-gray-900/10 pointer-events-none">
                                    <div class="text-gray-600 text-sm flex flex-col items-center gap-2">
                                        <i data-lucide="activity" class="w-8 h-8 opacity-50"></i>
                                        <span>è¿è¡Œç­–ç•¥ä»¥æŸ¥çœ‹å‡€å€¼æ›²çº¿</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Logs/Trades Tabs -->
                            <div class="h-40 border-t border-gray-800 flex flex-col shrink-0">
                                <div class="flex gap-2 text-xs p-2 bg-gray-900 border-b border-gray-800">
                                    <button id="tab-logs-btn" class="px-3 py-1 bg-blue-600 text-white rounded text-xs"
                                        onclick="switchLogTab('logs')">ğŸ“‹ è¿è¡Œæ—¥å¿—</button>
                                    <button id="tab-trades-btn"
                                        class="px-3 py-1 bg-gray-700 text-gray-400 rounded hover:bg-gray-600 text-xs"
                                        onclick="switchLogTab('trades')">ğŸ’° äº¤æ˜“æ˜ç»†</button>
                                </div>
                                <div id="panel-logs" class="flex-1 overflow-y-auto p-2 text-xs font-mono text-gray-400">
                                    <span class="text-gray-600">è¿è¡Œå›æµ‹åæŸ¥çœ‹æ—¥å¿—...</span>
                                </div>
                                <div id="panel-trades" class="flex-1 overflow-y-auto p-2 hidden">
                                    <span class="text-gray-600 text-xs">è¿è¡Œå›æµ‹åæŸ¥çœ‹äº¤æ˜“æ˜ç»†...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- JS Imports -->
    <script src="/static/js/api.js"></script>
    <script src="/static/js/ui.js"></script>
    <script src="/static/js/app.js"></script>
    <script>
        // Init Icons
        lucide.createIcons();
    </script>
</body>

</html>