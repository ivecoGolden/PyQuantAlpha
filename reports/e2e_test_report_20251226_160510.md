# PyQuantAlpha 端到端测试报告

> 生成时间: 2025-12-26 16:04:27


## 1. 输入的自然语言



```
请生成一个专业级量化交易策略，需要满足以下所有要求：

1. 多指标融合体系：
   - 使用 EMA20 和 EMA60 构建趋势判断系统
   - 使用 RSI(14) 判断超买超卖区域
   - 使用 ATR(14) 计算动态止损止盈距离
   - 使用 BollingerBands(20, 2.0) 判断价格相对位置

2. 入场条件（必须同时满足多个条件）：
   - 做多条件：EMA20 > EMA60（趋势向上）且 RSI < 40（回调到超卖区）且价格触及布林带下轨
   - 做空条件：EMA20 < EMA60（趋势向下）且 RSI > 60（反弹到超买区）且价格触及布林带上轨

3. 风险管理：
   - 止损距离：2 倍 ATR
   - 止盈距离：3 倍 ATR
   - 仅在无持仓时入场

4. 仓位管理：
   - 每次交易固定 0.1 个单位

5. 必须实现完整的 notify_order 和 notify_trade 回调，打印订单和交易信息

交易对：BTCUSDT
```


## 2. LLM 生成的策略代码



### 策略信息



| 属性 | 值 |
| --- | --- |
| LLM Provider | deepseek |
| 响应类型 | strategy |
| 交易对 | BTCUSDT |
| 代码长度 | 2568 字符 |
| 代码行数 | 68 行 |


### 完整代码



```python
class Strategy:
    def init(self):
        # 初始化指标
        self.ema20 = EMA(20)
        self.ema60 = EMA(60)
        self.rsi = RSI(14)
        self.atr = ATR(14)
        self.bb = BollingerBands(20, 2.0)
        
        # 设置固定仓位管理
        self.setsizer("fixed", stake=0.1)
        
        # 初始化状态变量
        self.position = None
        
    def on_bar(self, data):
        # 获取当前Bar数据
        bar = data
        
        # 更新指标
        ema20_val = self.ema20.update(bar.close)
        ema60_val = self.ema60.update(bar.close)
        rsi_val = self.rsi.update(bar.close)
        atr_val = self.atr.update(bar.high, bar.low, bar.close)
        bb_res = self.bb.update(bar.close)
        
        # 检查指标是否就绪（避免None值）
        if ema20_val is None or ema60_val is None or rsi_val is None or atr_val is None or bb_res is None:
            return
        
        # 获取当前持仓
        pos = self.get_position("BTCUSDT")
        
        # 仅在无持仓时入场
        if pos is None:
            # 计算止损止盈价格
            stop_distance = 2 * atr_val
            profit_distance = 3 * atr_val
            
            # 做多条件：EMA20 > EMA60（趋势向上）且 RSI < 40（回调到超卖区）且价格触及布林带下轨
            if ema20_val > ema60_val and rsi_val < 40 and bar.close <= bb_res.lower:
                # 计算止损止盈价格
                stop_price = bar.close - stop_distance
                limit_price = bar.close + profit_distance
                # 使用挂钩订单入场（买入+止损+止盈）
                self.buy_bracket("BTCUSDT", size=0.1, stopprice=stop_price, limitprice=limit_price)
                
            # 做空条件：EMA20 < EMA60（趋势向下）且 RSI > 60（反弹到超买区）且价格触及布林带上轨
            elif ema20_val < ema60_val and rsi_val > 60 and bar.close >= bb_res.upper:
                # 计算止损止盈价格
                stop_price = bar.close + stop_distance
                limit_price = bar.close - profit_distance
                # 使用挂钩订单入场（卖出+止损+止盈）
                self.sell_bracket("BTCUSDT", size=0.1, stopprice=stop_price, limitprice=limit_price)
    
    def notify_order(self, order):
        # 打印订单信息
        if order.status == "FILLED":
            print(f"订单成交: ID={order.id}, 交易对={order.symbol}, 方向={order.side}, 价格={order.price}, 数量={order.quantity}")
        elif order.status == "REJECTED":
            print(f"订单被拒绝: ID={order.id}, 交易对={order.symbol}")
        elif order.status == "CANCELLED":
            print(f"订单已取消: ID={order.id}, 交易对={order.symbol}")
    
    def notify_trade(self, trade):
        # 打印交易信息
        if trade.pnl != 0:
            print(f"交易平仓: 交易对={trade.symbol}, 盈亏={trade.pnl}, 手续费={trade.fee}, 时间={trade.timestamp}")
```


### 代码验证

✅ 验证通过

## 3. 市场数据



| 属性 | 值 |
| --- | --- |
| 交易对 | BTCUSDT |
| K线数量 | 1440 根 |
| 时间范围 | 2025-10-27 17:00:00 ~ 2025-12-26 16:00:00 |
| 价格范围 | $80600.00 ~ $116086.00 |


## 4. 交易日志



| 时间 | 交易对 | 方向 | 数量 | 价格 | PnL | 手续费 |
| --- | --- | --- | --- | --- | --- | --- |
| 2025-11-02 13:00 | BTCUSDT | SELL | 0.1000 | $110442.73 | $0.00 | $11.04 |
| 2025-11-03 06:00 | BTCUSDT | BUY | 0.1000 | $109578.00 | $+86.47 | $10.96 |
| 2025-11-06 01:00 | BTCUSDT | SELL | 0.1000 | $103852.10 | $0.00 | $10.39 |
| 2025-11-07 00:00 | BTCUSDT | BUY | 0.1000 | $100916.10 | $+293.60 | $10.09 |
| 2025-11-08 04:00 | BTCUSDT | SELL | 0.1000 | $103731.20 | $0.00 | $10.37 |
| 2025-11-10 08:00 | BTCUSDT | BUY | 0.1000 | $106368.12 | $-263.69 | $10.64 |
| 2025-11-12 00:00 | BTCUSDT | BUY | 0.1000 | $103451.13 | $0.00 | $10.35 |
| 2025-11-13 01:00 | BTCUSDT | SELL | 0.1000 | $101697.15 | $-175.40 | $10.17 |
| 2025-11-19 01:00 | BTCUSDT | SELL | 0.1000 | $93210.29 | $0.00 | $9.32 |
| 2025-11-19 13:00 | BTCUSDT | BUY | 0.1000 | $90520.64 | $+268.96 | $9.05 |
| 2025-11-23 10:00 | BTCUSDT | SELL | 0.1000 | $85957.34 | $0.00 | $8.60 |
| 2025-11-24 01:00 | BTCUSDT | BUY | 0.1000 | $86789.88 | $-83.25 | $8.68 |
| 2025-12-01 08:00 | BTCUSDT | BUY | 0.1000 | $87043.50 | $0.00 | $8.70 |
| 2025-12-01 10:00 | BTCUSDT | SELL | 0.1000 | $86678.93 | $-36.46 | $8.67 |
| 2025-12-02 23:00 | BTCUSDT | SELL | 0.1000 | $90804.58 | $0.00 | $9.08 |
| 2025-12-03 01:00 | BTCUSDT | BUY | 0.1000 | $91504.13 | $-69.95 | $9.15 |
| 2025-12-04 23:00 | BTCUSDT | BUY | 0.1000 | $93017.98 | $0.00 | $9.30 |
| 2025-12-05 22:00 | BTCUSDT | SELL | 0.1000 | $90242.53 | $-277.54 | $9.02 |
| 2025-12-08 02:00 | BTCUSDT | SELL | 0.1000 | $91318.10 | $0.00 | $9.13 |
| 2025-12-08 06:00 | BTCUSDT | BUY | 0.1000 | $89058.23 | $+225.99 | $8.91 |
| 2025-12-11 09:00 | BTCUSDT | BUY | 0.1000 | $90720.08 | $0.00 | $9.07 |
| 2025-12-11 12:00 | BTCUSDT | SELL | 0.1000 | $90391.33 | $-32.87 | $9.04 |
| 2025-12-12 05:00 | BTCUSDT | SELL | 0.1000 | $92811.96 | $0.00 | $9.28 |
| 2025-12-13 00:00 | BTCUSDT | BUY | 0.1000 | $89560.90 | $+325.11 | $8.96 |
| 2025-12-13 01:00 | BTCUSDT | BUY | 0.1000 | $90128.13 | $0.00 | $9.01 |
| 2025-12-15 01:00 | BTCUSDT | SELL | 0.1000 | $88766.26 | $-136.19 | $8.88 |
| 2025-12-17 23:00 | BTCUSDT | SELL | 0.1000 | $87189.82 | $0.00 | $8.72 |
| 2025-12-18 00:00 | BTCUSDT | BUY | 0.1000 | $87233.44 | $-4.36 | $8.72 |
| 2025-12-18 22:00 | BTCUSDT | SELL | 0.1000 | $88301.03 | $0.00 | $8.83 |
| 2025-12-19 01:00 | BTCUSDT | BUY | 0.1000 | $86901.17 | $+139.99 | $8.69 |
| 2025-12-21 22:00 | BTCUSDT | BUY | 0.1000 | $88109.21 | $0.00 | $8.81 |
| 2025-12-22 07:00 | BTCUSDT | SELL | 0.1000 | $88736.83 | $+62.76 | $8.87 |
| 2025-12-23 04:00 | BTCUSDT | BUY | 0.1000 | $88395.21 | $0.00 | $8.84 |
| 2025-12-23 23:00 | BTCUSDT | SELL | 0.1000 | $87399.73 | $-99.55 | $8.74 |
| 2025-12-25 07:00 | BTCUSDT | SELL | 0.1000 | $87625.62 | $0.00 | $8.76 |
| 2025-12-26 11:00 | BTCUSDT | BUY | 0.1000 | $88889.29 | $-126.37 | $8.89 |


### 交易统计



| 指标 | 值 |
| --- | --- |
| 总交易次数 | 36 |
| 买入次数 | 18 |
| 卖出次数 | 18 |
| 盈利交易 | 7 |
| 亏损交易 | 11 |
| 总手续费 | $333.73 |
| 平均盈利 | $200.41 |
| 最大单笔盈利 | $325.11 |
| 平均亏损 | $-118.69 |
| 最大单笔亏损 | $-277.54 |


## 5. 回测结果



### 核心指标



| 指标 | 值 |
| --- | --- |
| 总收益率 | -0.24% |
| 年化收益率 | -0.06% |
| 最大回撤 | 10.36% |
| 夏普比率 | 0.01 |
| 胜率 | 38.89% |
| 盈亏比 | 1.07 |
| 总交易次数 | 36 |


### 净值分析



| 指标 | 值 |
| --- | --- |
| 初始净值 | $100,000.00 |
| 最终净值 | $99,763.50 |
| 最高净值 | $111,078.41 |
| 最低净值 | $99,569.16 |
| 净值波动 | $11,509.26 |


## 耗时统计



| 环节 | 耗时 |
| --- | --- |
| LLM 初始化 | 0.52s |
| LLM 策略生成 | 38.59s |
| 代码验证 | 0.00s |
| 获取市场数据 | 4.08s |
| 回测执行 | 0.03s |
| **总耗时** | **43.22s** |


## 7. 测试环境



| 项目 | 值 |
| --- | --- |
| Python 版本 | 3.13.10 |
| LLM Provider | deepseek |
| 初始资金 | $100,000.00 |
| 手续费率 | 0.10% |
| 滑点 | 0.0500% |
| 数据周期 | 1h |
| 回测天数 | 60 |


## 8. 策略评分



**总评分: 65/100**

- ✅ 成功产生交易

- ⚠️ 总收益轻微亏损 (-0.24%)

- ⚠️ 胜率低于 50% (38.9%)

- ✅ 最大回撤可控 (10.36%)

- ⚠️ 夏普比率一般 (0.01)
